<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nammane Interiors Quotation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: clamp(1.5em, 5vw, 2em);
            margin-bottom: 5px;
        }

        .header p {
            font-size: clamp(0.85em, 2vw, 1em);
            opacity: 0.9;
        }

        .client-info {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .client-info-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .client-info-display div {
            font-size: clamp(0.85em, 2vw, 0.95em);
        }

        .client-info-display strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 3px;
            font-size: 0.85em;
        }

        .floors-container {
            padding: 20px;
        }

        .add-floor-section {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #dee2e6;
        }

        .floor-card {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 20px;
            background: #fafafa;
        }

        .floor-header {
            background: #34495e;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .floor-header h2 {
            font-size: clamp(1.1em, 4vw, 1.4em);
            font-weight: 600;
        }

        .floor-header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .floor-content {
            padding: 15px;
        }

        .add-section-btn-container {
            text-align: center;
            margin-top: 15px;
            padding-top: 10px;
        }

        .section {
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
        }

        .section-header {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 10px 15px;
            font-size: clamp(0.95em, 3vw, 1.1em);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .section-header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .units-list {
            padding: 15px;
        }

        /* Updated Unit Item Styling */
        .unit-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 4px;
            border-left: 3px solid #3498db;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .unit-delete-wrapper {
            flex: 0 0 auto;
        }

        .unit-content-wrapper {
            flex: 1;
        }

        .btn-icon-delete {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid #ffcdd2;
            background: #ffebee;
            color: #c62828;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.1em;
        }

        .btn-icon-delete:hover {
            background: #ef9a9a;
            color: white;
            border-color: #ef9a9a;
            transform: scale(1.1);
        }

        .unit-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 8px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: clamp(0.8em, 2vw, 0.85em);
        }

        .form-group input,
        .form-group select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: clamp(0.85em, 2vw, 0.95em);
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: clamp(0.8em, 2vw, 0.9em);
            white-space: nowrap;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: clamp(0.75em, 2vw, 0.85em);
        }

        .amount-display {
            text-align: right;
            font-size: clamp(0.85em, 2.5vw, 1em);
            font-weight: 600;
            color: #2c3e50;
            padding-top: 8px;
            border-top: 1px dashed #dee2e6;
        }

        .grand-total {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: clamp(1.3em, 5vw, 1.8em);
            font-weight: 700;
            margin: 20px 0;
            border-radius: 6px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 20px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: clamp(1.2em, 4vw, 1.5em);
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 700;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .modal-buttons .btn {
            flex: 1;
            min-width: 120px;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .floor-header,
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .floor-header-actions,
            .section-header-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .unit-form {
                grid-template-columns: 1fr;
            }

            .unit-item {
                flex-direction: column;
                align-items: stretch;
            }

            .unit-delete-wrapper {
                align-self: flex-end;
                margin-bottom: 10px;
            }

            .amount-display {
                text-align: left;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            /* Hide all action buttons in print mode */
            .action-buttons,
            .floor-header-actions,
            .section-header-actions,
            .add-floor-section,
            .add-section-btn-container,
            .btn-icon-delete {
                display: none !important;
            }

            .header {
                background: white !important;
                color: black !important;
                border-bottom: 3px solid #000;
            }

            .client-info {
                background: white !important;
                border: 2px solid #000;
                margin: 10px 0;
            }

            .floor-header {
                background: #000 !important;
                color: white !important;
                page-break-before: always;
            }

            .section-header {
                background: #333 !important;
                color: white !important;
            }

            .unit-item {
                border: 1px solid #ddd;
                page-break-inside: avoid;
                display: block;
                /* Remove flex in print */
            }

            .grand-total {
                background: #000 !important;
                color: white !important;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin: 10px 0;
            }

            table th,
            table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
                font-size: 10pt;
            }
        }
    </style>
</head>

<body>
    <div id="clientModal" class="modal show">
        <div class="modal-content">
            <div class="modal-header">Client Information</div>
            <div class="form-group">
                <label>Client Name:</label>
                <input type="text" id="clientName" placeholder="Enter client name">
            </div>
            <div class="form-group">
                <label>Location/Address:</label>
                <input type="text" id="clientAddress" placeholder="Enter address">
            </div>
            <div class="form-group">
                <label>Mobile Number:</label>
                <input type="text" id="clientPhone" placeholder="+91 XXXXXXXXXX">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="skipClientInfo()">Skip</button>
                <button class="btn btn-primary" onclick="saveClientInfo()">Continue</button>
            </div>
        </div>
    </div>

    <div id="sectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add New Section</div>
            <div class="form-group">
                <label>Section Type:</label>
                <select id="sectionType">
                    <option value="Kitchen">Kitchen</option>
                    <option value="Living Room">Living Room</option>
                    <option value="Bedroom">Bedroom</option>
                    <option value="Puja Room">Puja Room</option>
                    <option value="Bathroom">Bathroom</option>
                    <option value="Garage">Garage</option>
                    <option value="Study Room">Study Room</option>
                    <option value="Dining Room">Dining Room</option>
                    <option value="Balcony">Balcony</option>
                    <option value="Staircase">Staircase</option>
                    <option value="Store Room">Store Room</option>
                    <option value="Terrace">Terrace</option>
                    <option value="Custom">Custom (Enter Below)</option>
                </select>
            </div>
            <div class="form-group" id="customSectionGroup" style="display: none;">
                <label>Custom Section Name:</label>
                <input type="text" id="customSectionName" placeholder="Enter custom section name">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeSectionModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmAddSection()">Add Section</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>NAMMANE INTERIORS QUOTATION</h1>
            <p>Interior Design Quotation System</p>
        </div>

        <div class="client-info">
            <div class="client-info-display">
                <div><strong>CLIENT NAME:</strong> <span id="displayName">-</span></div>
                <div><strong>LOCATION:</strong> <span id="displayAddress">-</span></div>
                <div><strong>MOB NO:</strong> <span id="displayPhone">-</span></div>
                <div><strong>DATE:</strong> <span id="displayDate">-</span></div>
            </div>
        </div>

        <div class="floors-container">
            <div id="floorsContainer"></div>

            <div class="add-floor-section">
                <button class="btn btn-primary" onclick="addFloor()">+ Add New Floor</button>
            </div>

            <div class="grand-total">
                GRAND TOTAL: ‚Çπ<span id="grandTotal">0</span>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generatePDF()">üìÑ Download PDF</button>
                <button class="btn btn-primary" onclick="printQuotation()">üñ®Ô∏è Print Quotation</button>
            </div>
        </div>
    </div>

    <script>
        // ============ PRICING STRUCTURE ============
        const PRICING = {
            manual: {
                'Laminates': 950,
                'Laminates, Rafters, AL Profile': 1100,
                'Laminates and AL Profile': 1050,
                'Laminates, CNC, Fluted Glass': 1250,
                'Bevelled Glass': 1300,
                'Acrylic': 1400
            },
            modular: {
                'Laminates': 1200,
                'Laminates, Rafters, AL Profile': 1350,
                'Laminates and AL Profile': 1300,
                'Laminates, CNC, Fluted Glass': 1500,
                'Bevelled Glass': 1550,
                'Acrylic': 1650
            }
        };

        // Default units for each section type
        const DEFAULT_UNITS = {
            'Kitchen': ['Kitchen Base Unit', 'Kitchen Wall Unit', 'Kitchen Tall Unit'],
            'Living Room': ['TV Unit', 'Crockery Unit', 'Display Unit'],
            'Bedroom': ['Wardrobe', 'Dressing Unit', 'Side Table'],
            'Puja Room': ['Puja Base Unit', 'Mandir Unit'],
            'Bathroom': ['Vanity'],
            'Study Room': ['Study Table', 'Bookshelf'],
            'Dining Room': ['Dining Buffet', 'Crockery Unit'],
            'Balcony': ['Storage Unit'],
            'Staircase': ['Loft Storage'],
            'Store Room': ['Storage Unit', 'Overhead Storage'],
            'Terrace': ['Storage Unit'],
            'Garage': ['Storage Unit']
        };

        // Unit types list
        const UNIT_TYPES = [
            { group: 'Storage & Wardrobes', items: ['Sliding Wardrobe', 'Hinged Wardrobe', 'Walk-in Wardrobe', 'Storage Unit', 'Book Storage', 'Shoe Rack', 'Loft Storage', 'Overhead Storage', 'Wardrobe'] },
            { group: 'Kitchen Units', items: ['Kitchen Base Unit', 'Kitchen Wall Unit', 'Kitchen Tall Unit', 'Kitchen Island', 'Breakfast Counter', 'Pantry Unit', 'Corner Unit'] },
            { group: 'Living Room', items: ['TV Unit', 'TV Panel', 'Entertainment Unit', 'Crockery Unit', 'Display Unit', 'Console Table', 'Center Table', 'Showcase', 'Bar Unit', 'Foyer Unit'] },
            { group: 'Bedroom Furniture', items: ['Side Table', 'Bedside Table', 'Dressing Unit', 'Dressing Table', 'Study Table', 'Headboard', 'Bed with Storage', 'Ottoman'] },
            { group: 'Seating', items: ['Seating with Storage', 'Window Seating', 'Bay Window Seating', 'Sofa with Cushion', 'Bench Seating', 'Reading Nook'] },
            { group: 'Study & Office', items: ['Study Wall Unit', 'Office Desk', 'Workstation', 'Bookshelf', 'Filing Cabinet', 'Computer Table'] },
            { group: 'Bathroom & Utility', items: ['Vanity', 'Bathroom Cabinet', 'Medicine Cabinet', 'Linen Cabinet', 'Utility Unit', 'Laundry Cabinet'] },
            { group: 'Puja & Mandir', items: ['Puja Base Unit', 'Mandir Unit', 'Pooja Wall Unit', 'Temple Unit'] },
            { group: 'Panels & Partitions', items: ['Panel', 'Wall Panel', 'Decorative Panel', 'Fluted Panel', 'Partition', 'Jali Partition', 'Screen Partition'] },
            { group: 'Dining Area', items: ['Dining Table', 'Dining Buffet', 'Sideboard', 'Wine Rack', 'Serving Counter'] },
            { group: 'Other', items: ['Mirror Frame', 'Ceiling Design', 'False Ceiling', 'Shelving Unit', 'Floating Shelf', 'Niche Unit', 'Custom Unit'] }
        ];

        const MATERIALS = Object.keys(PRICING.manual);

        // ============ DATA STORAGE ============
        let clientData = {
            name: '',
            address: '',
            phone: '',
            date: new Date().toLocaleDateString()
        };

        let floors = {};
        let floorCounter = 0;
        let sectionCounter = 0;
        let unitCounter = 0;
        let currentFloorForSection = null;

        // ============ INITIALIZATION ============
        document.getElementById('displayDate').textContent = clientData.date;

        document.getElementById('sectionType').addEventListener('change', function () {
            const customGroup = document.getElementById('customSectionGroup');
            customGroup.style.display = this.value === 'Custom' ? 'block' : 'none';
        });

        // ============ CLIENT INFO FUNCTIONS ============
        function skipClientInfo() {
            document.getElementById('clientModal').classList.remove('show');
            initializeDefaultFloor();
        }

        function saveClientInfo() {
            clientData.name = document.getElementById('clientName').value || '-';
            clientData.address = document.getElementById('clientAddress').value || '-';
            clientData.phone = document.getElementById('clientPhone').value || '-';

            document.getElementById('displayName').textContent = clientData.name;
            document.getElementById('displayAddress').textContent = clientData.address;
            document.getElementById('displayPhone').textContent = clientData.phone;

            document.getElementById('clientModal').classList.remove('show');
            initializeDefaultFloor();
        }

        function initializeDefaultFloor() {
            addFloor();
            const groundFloorId = 'floor-1';
            addSection(groundFloorId, 'Kitchen', true);
            addSection(groundFloorId, 'Living Room', true);
            addSection(groundFloorId, 'Puja Room', true);
            addSection(groundFloorId, 'Bedroom', true);
        }

        // ============ FLOOR FUNCTIONS ============
        function addFloor() {
            const floorId = `floor-${++floorCounter}`;
            const floorName = floorCounter === 1 ? 'GROUND FLOOR' : `FLOOR ${floorCounter}`;

            floors[floorId] = {
                name: floorName,
                sections: {}
            };

            const floorCard = document.createElement('div');
            floorCard.className = 'floor-card';
            floorCard.id = floorId;

            // Note: add-section-btn-container is now BELOW the sections div
            floorCard.innerHTML = `
                <div class="floor-header">
                    <h2>${floorName}</h2>
                    <div class="floor-header-actions">
                        <button class="btn btn-secondary btn-small" onclick="editFloorName('${floorId}')">Rename</button>
                        <button class="btn btn-danger btn-small" onclick="deleteFloor('${floorId}')">Delete</button>
                    </div>
                </div>
                <div class="floor-content">
                    <div id="${floorId}-sections"></div>
                    <div class="add-section-btn-container">
                        <button class="btn btn-primary" onclick="openSectionModal('${floorId}')">+ Add Section</button>
                    </div>
                </div>
            `;

            document.getElementById('floorsContainer').appendChild(floorCard);
        }

        function editFloorName(floorId) {
            const newName = prompt('Enter new floor name:', floors[floorId].name);
            if (newName && newName.trim()) {
                floors[floorId].name = newName.trim();
                document.querySelector(`#${floorId} .floor-header h2`).textContent = newName.trim();
            }
        }

        function deleteFloor(floorId) {
            if (confirm('Are you sure you want to delete this floor and all its sections?')) {
                document.getElementById(floorId).remove();
                delete floors[floorId];
                updateGrandTotal();
            }
        }

        // ============ SECTION FUNCTIONS ============
        function openSectionModal(floorId) {
            currentFloorForSection = floorId;
            document.getElementById('sectionType').value = 'Kitchen';
            document.getElementById('customSectionName').value = '';
            document.getElementById('customSectionGroup').style.display = 'none';
            document.getElementById('sectionModal').classList.add('show');
        }

        function closeSectionModal() {
            document.getElementById('sectionModal').classList.remove('show');
            currentFloorForSection = null;
        }

        function confirmAddSection() {
            const sectionType = document.getElementById('sectionType').value;
            let sectionName;

            if (sectionType === 'Custom') {
                sectionName = document.getElementById('customSectionName').value.trim();
                if (!sectionName) {
                    alert('Please enter a custom section name');
                    return;
                }
            } else {
                sectionName = sectionType;
            }

            addSection(currentFloorForSection, sectionName);
            closeSectionModal();
        }

        function addSection(floorId, sectionName, isDefault = false) {
            const sectionId = `section-${++sectionCounter}`;

            floors[floorId].sections[sectionId] = {
                name: sectionName,
                units: {}
            };

            const sectionsContainer = document.getElementById(`${floorId}-sections`);
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section';
            sectionDiv.id = sectionId;

            sectionDiv.innerHTML = `
                <div class="section-header">
                    <span>${sectionName.toUpperCase()}</span>
                    <div class="section-header-actions">
                        <button class="btn btn-primary btn-small" onclick="addUnit('${floorId}', '${sectionId}')">+ Add Unit</button>
                        <button class="btn btn-danger btn-small" onclick="deleteSection('${floorId}', '${sectionId}')">Delete</button>
                    </div>
                </div>
                <div class="units-list" id="${sectionId}-units"></div>
            `;

            sectionsContainer.appendChild(sectionDiv);

            // Add default units for this section type
            const defaultUnits = DEFAULT_UNITS[sectionName] || [];
            defaultUnits.forEach(unitName => {
                addUnit(floorId, sectionId, unitName);
            });
        }

        function deleteSection(floorId, sectionId) {
            if (confirm('Are you sure you want to delete this section and all its units?')) {
                document.getElementById(sectionId).remove();
                delete floors[floorId].sections[sectionId];
                updateGrandTotal();
            }
        }

        // ============ UNIT FUNCTIONS ============
        function addUnit(floorId, sectionId, defaultUnitName = '') {
            const unitId = `unit-${++unitCounter}`;
            const container = document.getElementById(`${sectionId}-units`);

            const unitDiv = document.createElement('div');
            unitDiv.className = 'unit-item';
            unitDiv.id = unitId;

            let unitOptions = '<option value="">Select Unit</option>';
            UNIT_TYPES.forEach(group => {
                unitOptions += `<optgroup label="${group.group}">`;
                group.items.forEach(item => {
                    const selected = item === defaultUnitName ? 'selected' : '';
                    unitOptions += `<option value="${item}" ${selected}>${item}</option>`;
                });
                unitOptions += '</optgroup>';
            });

            let materialOptions = '';
            MATERIALS.forEach(material => {
                materialOptions += `<option value="${material}">${material}</option>`;
            });

            // UPDATED UNIT HTML: Delete button is now on the left (unit-delete-wrapper)
            unitDiv.innerHTML = `
                <div class="unit-delete-wrapper">
                    <button class="btn-icon-delete" title="Delete Unit" onclick="deleteUnit('${floorId}', '${sectionId}', '${unitId}')">
                        <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </button>
                </div>
                <div class="unit-content-wrapper">
                    <div class="unit-form">
                        <div class="form-group">
                            <label>Unit:</label>
                            <select id="${unitId}-unit" onchange="updateUnit('${floorId}', '${sectionId}', '${unitId}')">
                                ${unitOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Manual/Modular:</label>
                            <select id="${unitId}-mode" onchange="updateUnit('${floorId}', '${sectionId}', '${unitId}')">
                                <option value="manual">Manual</option>
                                <option value="modular">Modular</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Material:</label>
                            <select id="${unitId}-material" onchange="updateUnit('${floorId}', '${sectionId}', '${unitId}')">
                                ${materialOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Length (ft):</label>
                            <input type="number" id="${unitId}-length" step="0.1" placeholder="0" 
                                oninput="updateUnit('${floorId}', '${sectionId}', '${unitId}')">
                        </div>
                        <div class="form-group">
                            <label>Height (ft):</label>
                            <input type="number" id="${unitId}-height" step="0.1" placeholder="0" 
                                oninput="updateUnit('${floorId}', '${sectionId}', '${unitId}')">
                        </div>
                    </div>
                    <div class="amount-display">
                        Area: <span id="${unitId}-area">0</span> sqft | 
                        Rate: ‚Çπ<span id="${unitId}-rate">0</span>/sqft | 
                        Amount: ‚Çπ<span id="${unitId}-amount">0</span>
                    </div>
                </div>
            `;

            container.appendChild(unitDiv);

            floors[floorId].sections[sectionId].units[unitId] = {
                unit: defaultUnitName,
                mode: 'manual',
                material: MATERIALS[0],
                length: 0,
                height: 0,
                area: 0,
                rate: PRICING.manual[MATERIALS[0]],
                amount: 0
            };

            updateUnit(floorId, sectionId, unitId);
        }

        function updateUnit(floorId, sectionId, unitId) {
            const unit = floors[floorId].sections[sectionId].units[unitId];

            unit.unit = document.getElementById(`${unitId}-unit`).value;
            unit.mode = document.getElementById(`${unitId}-mode`).value;
            unit.material = document.getElementById(`${unitId}-material`).value;
            unit.length = parseFloat(document.getElementById(`${unitId}-length`).value) || 0;
            unit.height = parseFloat(document.getElementById(`${unitId}-height`).value) || 0;

            unit.area = (unit.length * unit.height).toFixed(2);
            unit.rate = PRICING[unit.mode][unit.material];
            unit.amount = (unit.area * unit.rate).toFixed(2);

            document.getElementById(`${unitId}-area`).textContent = unit.area;
            document.getElementById(`${unitId}-rate`).textContent = unit.rate;
            document.getElementById(`${unitId}-amount`).textContent = unit.amount;

            updateGrandTotal();
        }

        function deleteUnit(floorId, sectionId, unitId) {
            document.getElementById(unitId).remove();
            delete floors[floorId].sections[sectionId].units[unitId];
            updateGrandTotal();
        }

        // ============ TOTAL CALCULATION ============
        function updateGrandTotal() {
            let total = 0;

            Object.values(floors).forEach(floor => {
                Object.values(floor.sections).forEach(section => {
                    Object.values(section.units).forEach(unit => {
                        total += parseFloat(unit.amount || 0);
                    });
                });
            });

            document.getElementById('grandTotal').textContent = total.toFixed(2);
        }

        // ============ PDF GENERATION ============
        function generatePDF() {
            const total = document.getElementById('grandTotal').textContent;

            let htmlContent = '<!DOCTYPE html><html><head><meta charset="UTF-8">';
            htmlContent += '<title>Quotation - ' + clientData.name + '</title>';
            htmlContent += '<style>';
            htmlContent += '@page { size: A4; margin: 10mm; }';
            htmlContent += 'body { font-family: Arial, sans-serif; font-size: 9pt; margin: 0; padding: 10px; }';
            htmlContent += 'h1 { text-align: center; font-size: 18pt; margin: 5px 0; }';
            htmlContent += 'h2 { font-size: 11pt; margin: 8px 0 5px 0; }';
            htmlContent += '.client-info { border: 1px solid #000; padding: 8px; margin: 10px 0; }';
            htmlContent += '.client-info table { width: 100%; border-collapse: collapse; }';
            htmlContent += '.client-info td { padding: 3px; border: none; font-size: 9pt; }';
            htmlContent += '.section-title { background: #000; color: white; padding: 5px 8px; margin: 8px 0 5px 0; font-size: 10pt; font-weight: bold; }';
            htmlContent += 'table.data { width: 100%; border-collapse: collapse; margin: 5px 0 10px 0; font-size: 8pt; table-layout: fixed; }';
            htmlContent += 'table.data th, table.data td { border: 1px solid #000; padding: 4px 6px; text-align: left; }';
            htmlContent += 'table.data th { background: #e0e0e0; font-weight: bold; text-align: center; }';
            htmlContent += 'table.data col:nth-child(1) { width: 20%; }';
            htmlContent += 'table.data col:nth-child(2) { width: 12%; }';
            htmlContent += 'table.data col:nth-child(3) { width: 24%; }';
            htmlContent += 'table.data col:nth-child(4) { width: 8%; }';
            htmlContent += 'table.data col:nth-child(5) { width: 8%; }';
            htmlContent += 'table.data col:nth-child(6) { width: 10%; }';
            htmlContent += 'table.data col:nth-child(7) { width: 10%; }';
            htmlContent += 'table.data col:nth-child(8) { width: 8%; }';
            htmlContent += 'table.data td:nth-child(4), table.data td:nth-child(5) { text-align: center; }';
            htmlContent += 'table.data td:nth-child(6), table.data td:nth-child(7), table.data td:nth-child(8) { text-align: right; }';
            htmlContent += '.grand-total { background: #000; color: white; padding: 10px; text-align: center; font-size: 14pt; font-weight: bold; margin: 15px 0; }';
            htmlContent += '.specs { font-size: 8pt; line-height: 1.4; margin: 10px 0; }';
            htmlContent += '.specs h3 { font-size: 10pt; margin: 10px 0 5px 0; }';
            htmlContent += '.specs p { margin: 5px 0; }';
            htmlContent += '.specs ul { margin: 5px 0; padding-left: 20px; }';
            htmlContent += '.page-break { page-break-before: always; }';
            htmlContent += '</style></head><body>';

            htmlContent += '<h1>NAMMANE INTERIORS - QUOTATION</h1>';

            htmlContent += '<div class="client-info"><table>';
            htmlContent += '<tr><td style="width:50%;"><strong>CLIENT NAME:</strong> ' + clientData.name + '</td>';
            htmlContent += '<td style="width:50%;"><strong>DATE:</strong> ' + clientData.date + '</td></tr>';
            htmlContent += '<tr><td><strong>LOCATION:</strong> ' + clientData.address + '</td>';
            htmlContent += '<td><strong>MOB NO:</strong> ' + clientData.phone + '</td></tr>';
            htmlContent += '</table></div>';

            htmlContent += '<div class="section-title">DESIGN SPECIFICATION</div>';

            Object.values(floors).forEach(function (floor) {
                htmlContent += '<h2>' + floor.name + '</h2>';

                Object.values(floor.sections).forEach(function (section) {
                    const units = Object.values(section.units);
                    if (units.length > 0) {
                        htmlContent += '<div style="font-weight: bold; margin: 8px 0 4px 0; text-transform: uppercase;">' + section.name + '</div>';
                        htmlContent += '<table class="data">';
                        htmlContent += '<colgroup><col><col><col><col><col><col><col><col></colgroup>';
                        htmlContent += '<thead><tr>';
                        htmlContent += '<th>UNIT</th>';
                        htmlContent += '<th>Manual/<br>Modular</th>';
                        htmlContent += '<th>Material Specification</th>';
                        htmlContent += '<th>L in ft</th>';
                        htmlContent += '<th>B in ft</th>';
                        htmlContent += '<th>Area<br>(Sqft)</th>';
                        htmlContent += '<th>Rate per<br>Sqft</th>';
                        htmlContent += '<th>Amount</th>';
                        htmlContent += '</tr></thead><tbody>';

                        units.forEach(function (unit) {
                            htmlContent += '<tr>';
                            htmlContent += '<td>' + (unit.unit || '-') + '</td>';
                            htmlContent += '<td style="text-transform: uppercase;">' + unit.mode + '</td>';
                            htmlContent += '<td>' + unit.material + '</td>';
                            htmlContent += '<td style="text-align: center;">' + unit.length + '</td>';
                            htmlContent += '<td style="text-align: center;">' + unit.height + '</td>';
                            htmlContent += '<td>' + unit.area + '</td>';
                            htmlContent += '<td>' + unit.rate + '</td>';
                            htmlContent += '<td><strong>' + unit.amount + '</strong></td>';
                            htmlContent += '</tr>';
                        });

                        htmlContent += '</tbody></table>';
                    }
                });
            });

            htmlContent += '<div class="grand-total">GRAND TOTAL= ' + total + '</div>';

            htmlContent += '<div class="page-break"></div>';
            htmlContent += '<div class="specs">';
            htmlContent += '<h2 style="text-align: center;">MATERIAL SPECIFICATION</h2>';

            htmlContent += '<h3>Plywood & Laminates:</h3>';
            htmlContent += '<p>For all modular finish carcass, loft, shutters, panelling, partitions & storage units are made up of 16mm IS 303 MR Grade Plywood with 1mm decorative laminate finish (MERINO /SKYDECOR /ADVANCE /GREENLAM /EQUIVALENT) and 0.8mm fabric laminate outer & inner face of plywood respectively as per the client selection. All exposed edges of ply sealed with 0.8mm thick edge banding, 2mm thick edge banding for shutters & 1.3mm thick edge banding for acrylic.</p>';
            htmlContent += '<p><strong>Note:</strong> In case of Kitchen base unit & vanity (only in wet area) BWP grade (Boiling Water Proof) IS 710 of 16mm thick ply is used. HDHMR 16mm grade ply is used for acrylic finish laminates. In case the depth of the carcass exceeds the standard dimension( >600mm) then there will be increase in the rate per sqft accordingly.</p>';

            htmlContent += '<h3>Accessories & Hardware:</h3>';
            htmlContent += '<p>Most of the hardware items are of EBCO/EQUIVALENT Brand. (HETTICH/HAFELE only if specified). Handles, knobs & SS hanger rods are of good brand. Locks-Europa.</p>';

            htmlContent += '<h3>False ceiling & Lighting:</h3>';
            htmlContent += '<p>12mm Gypsum board on GI channel framework (SAINT GOBAIN/INDIA GYPSUM/ EQUIVALENT). Cove lighting with LED strips & down lights (PHILIPS/HAVEL/WIPRO/EQUIVALENT). Provision of lights only if client specifies. The quotation for false ceiling does not includes the putty and painting cost, it comes under the scope of client. <strong>NOTE: PAINTING COST FOR FALSE CEILING IS NOT INCLUDED IN THE QUOTATION AMOUNT MENTIONED ABOVE. IT COMES UNDER THE SCOPE OF CLIENT.</strong></p>';

            htmlContent += '<h2 style="text-align: center; margin: 20px 0 15px 0;">TERMS & CONDITIONS</h2>';

            htmlContent += '<p><strong>1. Quotation Validity:</strong> 30 days from the date of issue. Quoted rate may vary based on final design.</p>';
            htmlContent += '<p><strong>2. Design Revisions:</strong> Up to 2 free design revisions are included. Further changes may incur additional charges.</p>';
            htmlContent += '<p><strong>3. Scope of Work:</strong> The scope includes only the items and services mentioned in this quotation. Any additional work will be treated as variation and charged extra.</p>';
            htmlContent += '<p><strong>4. Materials & Brands:</strong> Materials mentioned will be used or matched as closely as possible. Equivalent brands will be used if specified materials are unavailable, with client approval.</p>';
            htmlContent += '<p><strong>5. Work Schedule:</strong> The estimated project completion time is 6 to 8 weeks from the date of clearance of 50% advance payment.</p>';

            htmlContent += '<p><strong>6. Payment Terms:</strong></p>';
            htmlContent += '<ul>';
            htmlContent += '<li>10% advance on booking</li>';
            htmlContent += '<li>50% for commencement of work (40% in case advanced earlier)</li>';
            htmlContent += '<li>25% on 1st stage of material delivery</li>';
            htmlContent += '<li>20% on 2nd stage of material delivery</li>';
            htmlContent += '<li>5% upon handover</li>';
            htmlContent += '</ul>';

            htmlContent += '<p><strong>7. GST & Taxes:</strong> Quoted prices are exclusive of GST. Any changes in tax structure will be applicable at the time of billing.</p>';
            htmlContent += '<p><strong>8. Warranty:</strong> A standard 1-year service warranty is applicable on workmanship. Manufacturer warranty applies for plywood (10 years) and not for hardwares.</p>';
            htmlContent += '<p><strong>9. Cancellation / Refunds:</strong> All payments made at each stage are Non-Refundable.</p>';
            htmlContent += '<p><strong>10. Final Handover:</strong> The site will be handed over only after full and final payment is received.</p>';

            htmlContent += '</div></body></html>';

            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (isMobile) {
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Quotation_' + clientData.name.replace(/\s+/g, '_') + '_' + new Date().getTime() + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('Quotation HTML file downloaded! Open it in your browser and use "Print to PDF" to save as PDF.');
            } else {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(htmlContent);
                printWindow.document.close();

                printWindow.onload = function () {
                    printWindow.focus();
                    setTimeout(function () {
                        printWindow.print();
                    }, 250);
                };
            }
        }

        function printQuotation() {
            window.print();
        }
    </script>
</body>

</html>
